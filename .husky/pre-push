CLEAR_LINE="\033[1K"

TESTS_FAILED=false
FORMATTING_FAILED=false
LINT_FAILED=false
ASTRO_CHECK_FAILED=false
ASTRO_BUILD_FAILED=false


echo "\n Checking code with husky üê∫\n"
# echo " --------------------------------------"
echo ""

env echo " ‚è≥ Lint check running...             "
echo ""

if ! npm run format &> /dev/null; then
	FORMATTING_FAILED=true
  # echo "${CLEAR_LINE}\r| ‚ùå ESLint found errors. Please fix the linting errors before committing."
  echo "  ‚ùå Prettier found errors. Please fix the linting errors before committing."
  # echo "-----------------------------------------------------------------------------------------"
else
	echo "  ‚úÖ Prettier passed."
	# echo "-----------------"
fi

echo ""
echo ""

env echo " ‚è≥ Lint check running...             "
echo ""

if ! npm run lint &> /dev/null; then
	LINT_FAILED=true
  # echo "${CLEAR_LINE}\r| ‚ùå ESLint found errors. Please fix the linting errors before committing."
  echo "  ‚ùå ESLint found errors. Please fix the linting errors before committing."
  # echo "-----------------------------------------------------------------------------------------"
else
	echo "  ‚úÖ ESLint passed."
	# echo "-----------------"
fi

echo ""
echo ""
# env echo -n "| ‚è≥ Tests check running...            |"
env echo " ‚è≥ Tests check running...            "
echo ""

if npm test &> /dev/null
then
    # echo -e "${CLEAR_LINE}\r| ‚úÖ Tests check passed!               |"
    echo "  ‚úÖ Tests check passed!               "
else
    # echo -e "${CLEAR_LINE}\r| ‚ùå Tests check failed (Oops‚ùóÔ∏è)       |"
    echo "  ‚ùå Tests check failed (Oops‚ùóÔ∏è)       "
    TESTS_FAILED=true
fi

echo ""
echo ""

echo "‚è≥ Astro type check running..."
echo ""

if ! npm run check &> /dev/null; then
  ASTRO_CHECK_FAILED=true
  echo "  ‚ùå Astro check failed. Please fix the issues before committing."
else
  echo "  ‚úÖ Astro check passed."
fi

echo ""
echo ""
echo ""


echo "‚è≥ Building Astro site..."
echo ""

if ! npm run build; then
  echo ""
  ASTRO_BUILD_FAILED=true
  echo "  ‚ùå Build failed. Please fix the issues before continuing."
else
  echo "  ‚úÖ Build succeeded."
fi

echo ""
echo ""
echo ""

if [ "$FORMATTING_FAILED" = "true" ] || [ "$LINT_FAILED" = "true" ] || [ "$TESTS_FAILED" = "true" ] || [ "$ASTRO_CHECK_FAILED" = "true" ] || [ "$ASTRO_BUILD_FAILED" = "true" ]; then

  echo "\033[0;31müö®  Due to an error in one of the checks, git commit attempt was aborted\033[0m"
  if [ "$FORMATTING_FAILED" = "true" ]; then
	  echo ""
    echo "üí° For more information about lint errors, run 'npm run format'"
  fi
  if [ "$LINT_FAILED" = "true" ]; then
	  echo ""
    echo "üí° For more information about lint errors, run 'npm run lint'"
  fi
  if [ "$TESTS_FAILED" = "true" ]; then
	  echo ""
    echo "üí° For more information about failing tests, run 'npm run test'"
  fi

  if [ "$ASTRO_CHECK_FAILED" = "true" ]; then
    echo ""
    echo "üí° For more information about Astro type errors, run 'npm run check:astro'"
  fi
  if [ "$ASTRO_BUILD_FAILED" = "true" ]; then
    echo ""
    echo "üí° For more information about Astro build errors, run 'npm run build'"
  fi
  echo ""
  exit 1
else
  echo "\033[0;32mGood job mate!\033[0m"
	echo ""
	echo ""
  echo "Pushing Code..."
	echo ""
	echo ""
  exit 0
fi
